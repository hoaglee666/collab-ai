<div class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
  @if (isOpen()) {
  <div
    class="mb-4 w-80 md:w-96 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-slate-700 overflow-hidden flex flex-col h-[500px] animate-fade-in-up"
  >
    <div
      class="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 flex justify-between items-center text-white"
    >
      <div class="flex items-center gap-2">
        <span class="text-2xl">ðŸ¤–</span>
        <div>
          <h3 class="font-bold text-sm">Collab Advisor</h3>
          <p class="text-[10px] opacity-80">Powered by Gemini AI</p>
        </div>
      </div>
      <button (click)="toggleChat()" class="hover:bg-white/20 rounded-full p-1 transition">
        âœ•
      </button>
    </div>

    <div
      #scrollContainer
      class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-slate-900 scrollbar-thin"
    >
      <div *ngFor="let msg of messages()" class="flex" [class.justify-end]="msg.sender === 'user'">
        <div
          class="max-w-[80%] p-3 text-sm rounded-xl shadow-sm"
          [ngClass]="
            msg.sender === 'user'
              ? 'bg-purple-600 text-white rounded-br-none'
              : 'bg-white dark:bg-slate-700 text-gray-800 dark:text-gray-200 border border-gray-100 dark:border-slate-600 rounded-bl-none'
          "
        >
          {{ msg.text }}
        </div>
      </div>

      @if (isLoading()) {
      <div
        class="flex gap-1 p-3 bg-white dark:bg-slate-700 rounded-xl rounded-bl-none w-16 border border-gray-100 dark:border-slate-600"
      >
        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
        <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
      </div>
      }
    </div>

    <div
      class="p-3 bg-white dark:bg-slate-800 border-t border-gray-100 dark:border-slate-700 flex gap-2"
    >
      <input
        type="text"
        [(ngModel)]="userMessage"
        (keyup.enter)="sendMessage()"
        placeholder="Ask for advice..."
        class="flex-1 text-sm bg-gray-100 dark:bg-slate-700 border-none rounded-full px-4 focus:ring-2 focus:ring-purple-500 outline-none dark:text-white"
      />
      <button
        (click)="sendMessage()"
        [disabled]="!userMessage.trim() || isLoading()"
        class="bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-full disabled:opacity-50 transition"
      >
        âž¤
      </button>
    </div>
  </div>
  }

  <button
    (click)="toggleChat()"
    class="w-14 h-14 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-110 transition-transform duration-200 group relative"
  >
    @if (!isOpen()) {
    <span class="text-3xl">âœ¨</span>
    <span class="absolute top-0 right-0 -mt-1 -mr-1 flex h-4 w-4">
      <span
        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-purple-400 opacity-75"
      ></span>
      <span
        class="relative inline-flex rounded-full h-4 w-4 bg-red-500 border-2 border-white"
      ></span>
    </span>
    } @else {
    <span class="text-xl font-bold">âœ•</span>
    }
  </button>
</div>
