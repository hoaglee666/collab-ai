<div class="min-h-screen bg-gray-50 dark:bg-slate-900 flex flex-col">
  <header class="bg-white shadow-sm p-6 dark:bg-slate-900">
    <div class="max-w-5xl mx-auto">
      <a
        routerLink="/dashboard"
        class="text-blue-600 hover:text-blue-800 font-medium mb-4 inline-block transition"
      >
        &larr; Back to Dashboard
      </a>

      @if (isLoading()) {
      <div class="animate-pulse h-8 w-64 bg-gray-200 rounded"></div>
      } @else if (project()) {
      <div class="flex flex-col md:flex-row gap-6 items-start">
        @if (project().imageUrl) {
        <img
          [src]="'http://localhost:3000' + project().imageUrl"
          class="w-full md:w-64 h-40 object-cover rounded-lg shadow-md border border-gray-200"
        />
        }

        <div>
          <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-300">{{ project().name }}</h1>
          <div class="flex items-center gap-2 mt-2 text-gray-500 text-sm">
            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded font-bold text-xs">
              {{ project().status | uppercase }}
            </span>
            <span>â€¢</span>
            <span class="dark:text-gray-300"
              >Created by
              <span class="font-semibold text-gray-700 dark:text-gray-300">{{
                project().User?.username
              }}</span></span
            >
            <span>â€¢</span>
            <span class="dark:text-gray-300">{{ project().createdAt | date : 'mediumDate' }}</span>
          </div>
          <p class="mt-4 text-gray-700 dark:text-gray-300 text-lg leading-relaxed max-w-2xl">
            {{ project().description }}
          </p>
        </div>
      </div>
      } @else {
      <p class="text-red-500 dark:text-gray-300">Project not found.</p>
      }
    </div>
  </header>

  <main class="flex-1 max-w-5xl mx-auto w-full p-6">
    <div
      class="bg-white dark:bg-slate-800 dark:text-gray-300 rounded-xl shadow-sm border border-gray-100 p-8"
    >
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-gray-800 dark:text-gray-300">âœ… Project Tasks</h3>
        <span class="text-sm text-gray-500 dark:text-gray-300">{{ tasks().length }} items</span>
        <button
          (click)="generateAiTasks()"
          [disabled]="isAiLoading()"
          class="px-3 py-1 bg-purple-100 text-purple-700 rounded-md text-sm font-bold hover:bg-purple-200 transition flex items-center gap-2"
        >
          <span>{{ isAiLoading() ? 'ðŸ”® Thinking...' : 'âœ¨ AI Auto-Plan' }}</span>
        </button>
      </div>

      <div class="flex gap-2 mb-8">
        <input
          type="text"
          [(ngModel)]="newTaskDescription"
          (keyup.enter)="addTask()"
          placeholder="Add a new task..."
          class="flex-1 rounded-lg border-gray-300 border px-4 py-3 focus:ring-2 focus:ring-blue-500 outline-none transition bg-gray-50 dark:bg-slate-800 dark:text-gray-300"
        />
        <button
          (click)="addTask()"
          class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition shadow-md"
        >
          + Add
        </button>
      </div>

      <div class="space-y-3">
        @if (tasks().length === 0) {
        <p class="text-center text-gray-400 py-8 dark:text-gray-300">
          No tasks yet. Add one above!
        </p>
        }

        <div
          *ngFor="let task of tasks()"
          class="flex items-center gap-4 p-4 rounded-lg dark:bg-slate-800 border border-gray-100 hover:bg-gray-50 transition group bg-white"
        >
          <div
            (click)="toggleTask(task)"
            class="w-6 h-6 rounded border-2 cursor-pointer flex items-center justify-center transition-colors duration-200"
            [class.bg-green-500]="task.isCompleted"
            [class.border-green-500]="task.isCompleted"
            [class.border-gray-300]="!task.isCompleted"
          >
            <span *ngIf="task.isCompleted" class="text-white text-sm font-bold">âœ“</span>
          </div>

          <span
            class="text-gray-700 flex-1 text-lg dark:text-gray-300"
            [class.line-through]="task.isCompleted"
            [class.text-gray-400]="task.isCompleted"
          >
            {{ task.description }}
          </span>

          <button
            class="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"
          >
            âœ•
          </button>
        </div>
      </div>
    </div>
  </main>
</div>
